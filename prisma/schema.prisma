generator client {
  provider = "prisma-client-js"
}

datasource db {
  provider = "mongodb"
  url      = env("DATABASE_URL")
}

model User {
  id             String   @id @default(auto()) @map("_id") @db.ObjectId
  name           String
  email          String   @unique
  password       String
  phoneNumber    Int
  Otp            Int?
  profilePicture String?
  isAdmin        Boolean? @default(false)
  address        Json?    @default("[]")

  createdAt DateTime   @default(now())
  updatedAt DateTime   @updatedAt
  reviews   Review[]
  Cart      Cart[]
  Order     Order[]
  wishlist  wishlist[]
}

model Category {
  id            String        @id @default(auto()) @map("_id") @db.ObjectId
  name          String
  description   String?
  image         String? // optional image URL or path
  createdAt     DateTime      @default(now())
  updatedAt     DateTime      @updatedAt
  subcategories Subcategory[] @relation("CategoryToSubcategory")
  products      Product[]     @relation("CategoryToProduct")
}

model Subcategory {
  id          String    @id @default(auto()) @map("_id") @db.ObjectId
  name        String
  description String?
  image       String? // Optional image field
  createdAt   DateTime  @default(now())
  updatedAt   DateTime  @updatedAt
  categoryId  String    @db.ObjectId
  category    Category  @relation("CategoryToSubcategory", fields: [categoryId], references: [id])
  products    Product[] @relation("SubcategoryToProduct")
}

// Product
model Product {
  id                 String @id @default(auto()) @map("_id") @db.ObjectId
  title              String
  description        String
  price              Float
  discountPrice      Float?
  discountPercentage Int?
  stock              Int

  images        String[]
  averageRating Float?   @default(0)
  createdAt     DateTime @default(now())
  updatedAt     DateTime @updatedAt

  // Foreign Keys
  categoryId     String         @db.ObjectId
  subcategoryId  String         @db.ObjectId
  brandId        String         @db.ObjectId
  productColorId String[]       @db.ObjectId
  productSizeId  String[]       @db.ObjectId
  // Relations
  category       Category       @relation("CategoryToProduct", fields: [categoryId], references: [id])
  subcategory    Subcategory    @relation("SubcategoryToProduct", fields: [subcategoryId], references: [id])
  brand          Brand          @relation(fields: [brandId], references: [id])
  productColor   ProductColor[] @relation(fields: [productColorId], references: [id])
  productSize    ProductSize[]  @relation(fields: [productSizeId], references: [id])
  //  parameters  Parameter[] @relation(fields: [parameterId], references: [id])
  reviews        Review[]

  specifications ProductSpecification[]
}

model ProductColor {
  id      String @id @default(auto()) @map("_id") @db.ObjectId
  name    String // "Volt"
  hexCode String // hex color value, e.g., "#FF5733"

  productId String[]  @db.ObjectId
  product   Product[] @relation(fields: [productId], references: [id])
  Cart      Cart[]
}

model Review {
  id        String   @id @default(auto()) @map("_id") @db.ObjectId
  rating    Int
  comment   String?
  images    String[]
  userId    String   @db.ObjectId
  productId String   @db.ObjectId
  createdAt DateTime @default(now())

  product Product @relation(fields: [productId], references: [id])
  user    User    @relation(fields: [userId], references: [id])
}

model Brand {
  id        String    @id @default(auto()) @map("_id") @db.ObjectId
  name      String    @unique
  logo      String?
  createdAt DateTime  @default(now())
  updatedAt DateTime  @updatedAt
  products  Product[]
}

model ProductSize {
  id        String    @id @default(auto()) @map("_id") @db.ObjectId
  name      String
  productId String[]  @db.ObjectId
  product   Product[] @relation(fields: [productId], references: [id])
  Cart      Cart[]
}

model ProductSpecification {
  id    String @id @default(auto()) @map("_id") @db.ObjectId
  name  String // e.g., "Material"
  value String // e.g., "Cotton"

  productId String  @db.ObjectId
  product   Product @relation(fields: [productId], references: [id])
}

model Cart {
  id             String        @id @default(auto()) @map("_id") @db.ObjectId
  userId         String        @db.ObjectId
  items          Json
  discount       Int  @default(0)
  // productColorId String       @db.ObjectId
  // productColor   ProductColor @relation(fields: [productColorId], references: [id])
  // ProductSizeId  String       @db.ObjectId
  // ProductSize    ProductSize  @relation(fields: [ProductSizeId], references: [id])
  breakdown      Json?
  totalPrice     Float         @default(0)
  totalQuantity  Int           @default(0)
  createdAt      DateTime      @default(now())
  updatedAt      DateTime      @updatedAt
  user           User          @relation(fields: [userId], references: [id])
  ProductColor   ProductColor? @relation(fields: [productColorId], references: [id])
  productColorId String?       @db.ObjectId
  ProductSize    ProductSize?  @relation(fields: [productSizeId], references: [id])
  productSizeId  String?       @db.ObjectId
}

model Order {
  id         String @id @default(auto()) @map("_id") @db.ObjectId
  userId     String @db.ObjectId
  items      Json
  totalPrice Float

  totalQuantity Int
  status        String?  @default("Pending")
  address       String
  chargeId      String?
  paymentLinkId String?
  transactionId String?
  createdAt     DateTime @default(now())
  updatedAt     DateTime @updatedAt
  user          User     @relation(fields: [userId], references: [id])
}

model wishlist {
  id        String   @id @default(auto()) @map("_id") @db.ObjectId
  items     Json
  userId    String   @db.ObjectId
  createdAt DateTime @default(now())
  updatedAt DateTime @updatedAt
  user      User     @relation(fields: [userId], references: [id])
}

model carousel {
  id          String   @id @default(auto()) @map("_id") @db.ObjectId
  brand       String   @unique
  logoURL     String
  description String?
  offer       String?
  image       String
  createdAt   DateTime @default(now())
  updatedAt   DateTime @updatedAt
}

model PayPalTransaction {
  id        String   @id @default(auto()) @map("_id") @db.ObjectId
  orderId   String   @unique
  status    String
  amount    Float
  currency  String
  createdAt DateTime @default(now())
  updatedAt DateTime @updatedAt
}

model PromoCode {
  id                  String    @id @default(auto()) @map("_id") @db.ObjectId
  code                String    @unique
  description         String?
  discountType        String // 'percentage' or 'fixed'
  discountValue       Float
  maxDiscountValue    Float?
  minOrderAmount      Float?
  perUserLimit        Int?
  usageLimit          Int?
  usedCount           Int       @default(0)
  startAt             DateTime?
  expiresAt           DateTime?
  isActive            Boolean   @default(true)
  isPublic            Boolean   @default(true)
  appliesToProductIds String[]

  customerId      String?
  promoCodeUsages PromoCodeUsage[]
  createdAt       DateTime         @default(now())
  updatedAt       DateTime         @updatedAt
}

model PromoCodeUsage {
  id          String    @id @default(auto()) @map("_id") @db.ObjectId
  userId      String    @db.ObjectId
  promoCodeId String    @db.ObjectId
  usedAt      DateTime  @default(now())
  promoCode   PromoCode @relation(fields: [promoCodeId], references: [id])
}
